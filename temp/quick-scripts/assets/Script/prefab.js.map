{"version":3,"sources":["prefab.js"],"names":["cc","Class","extends","Component","properties","itemScrollView","type","Node","default","prefabItem","Prefab","itemContent","start","jsInstance","initDataOnlyOnce","initData","initPrefabItemCachePool","reLoadData","start_index","on","scrollEnded","bind","beginCountDown","countDownLeftTime","slice","initStart_Y","y","prefabItemCachePool","itemContentHeight","_contentSize","height","itemHeight","data","i","length","friendItemPrefab","label","getChildByName","getComponent","Label","inviteLab","physicalLocation","active","itemTemp","isClicked","string","time","prefabData","upDateLableString","item","self","schedule","index","tempItem","_scrollveiwDidScrolled","node","elastic","isScrollDown","page_num","start_y","_scrollDown","isScrollUp","_scrollUp","_autoScrolling","down_loaded","console","log","out_len","up_loaded","showClick","hiddeClick","countDownCallBack","Math","floor","instantiate","parent","EventType","TOUCH_END","touchEvent","push","update","dt","getData","initCountDownLeftTimeArr","temp","name","randomLength","random","updatePrefabData","allNames","setNameArr","indexOf","oldItem","nameArr","_setNewNameArr","tempArr","newNameArr","nameTemp"],"mappings":"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","file":"prefab.js","sourceRoot":"../../../../assets/Script","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        //需要挂载上的scorllview\n        itemScrollView:{\n            type:cc.Node,\n            default:null,\n        },\n\n        //预制体\n        prefabItem:{\n            type:cc.Prefab,\n            default:null,\n        },\n\n        //装预制体content\n        itemContent:{\n            type:cc.Node,\n            default:null,\n        },\n    },\n\n    start () {\n\n        cc.jsInstance = {\n\n        }\n\n        //只初始化一次的数据\n        this.initDataOnlyOnce();\n        \n\t\t//初始化数据\n        this.initData();\n        \n        //预制体缓存池，只初始化一次\n        this.initPrefabItemCachePool();\n\n        //装载数据 从0开始\n        this.reLoadData(this.start_index);\n        \n        //监听滑动结束事件\n        this.itemScrollView.on(\"scroll-ended\", this.scrollEnded.bind(this), this);\n        \n        //启动定时器\n\t\tthis.beginCountDown();\n    },\n\n    initDataOnlyOnce(){\n        if(cc.jsInstance.countDownLeftTime){\n            this.countDownLeftTime = cc.jsInstance.countDownLeftTime.slice(0);\n        }else{\n            this.countDownLeftTime = [];                                    //记录每个item剩余时间的大数组 \n        }\n        this.initStart_Y = this.itemContent.y;                          //列表content的初始y的位置 \n        this.prefabItemCachePool = [];                                  //所有预制体的存放池\n        this.itemContentHeight = this.itemContent._contentSize.height   //content高度\n\t\tthis.itemHeight = this.prefabItem.data._contentSize.height\t\t//预制体的高度\n    },\n\n    //tableview 刷新数据\n    reLoadData(start_index){\n        this.start_index = start_index;\n        for(var i = 0; i < this.prefabItemCachePool.length; i ++) {\n            var friendItemPrefab = this.prefabItemCachePool[i];\n            //注意替换节点\n\t\t\tvar label = friendItemPrefab.getChildByName(\"name\").getComponent(cc.Label);\n            var inviteLab = friendItemPrefab.getChildByName(\"invitebtn\").getChildByName(\"invite\").getComponent(cc.Label);\n            \n            friendItemPrefab.physicalLocation = start_index+i;\n            \n\t\t\tif(start_index + i < this.countDownLeftTime.length-1){\n\t\t\t\tfriendItemPrefab.active = true;\n                var itemTemp = this.countDownLeftTime[start_index+i];\n                \n                //赋值\n                if(itemTemp.isClicked){\n                    inviteLab.string = itemTemp.time;\n                }else{\n                    inviteLab.string = \"邀请\";\n                }\n                //this.prefabData 对象取到name\n                label.string = this.prefabData[start_index+i];\n            }else{\n                friendItemPrefab.active = false;\n\t\t\t\tcontinue;\n            }\n            \n\t\t\t\n        }\n\t},\n\n    //更新UI\n\tupDateLableString(item){\n        var self = this;\n        //定时器2，做赋值操作\n\t\tthis.schedule(function(){\n\t\t\tvar index = item.physicalLocation;\n\t\t\tvar tempItem = self.countDownLeftTime[index];\n\t\t\tif(tempItem.isClicked){\n                //注意替换节点\n\t\t\t\titem.getChildByName(\"invitebtn\").getChildByName(\"invite\").getComponent(cc.Label).string = tempItem.time;\n\t\t\t}else{\n\t\t\t\titem.getChildByName(\"invitebtn\").getChildByName(\"invite\").getComponent(cc.Label).string = \"邀请\";\n\t\t\t\ttempItem.isClicked = false;\n\t\t\t\ttempItem.time = 120;\n\t\t\t}\n\t\t},1);\n\t},\n\n\tscrollEnded(){\n\t\tthis._scrollveiwDidScrolled();\n\t\tthis.node.getChildByName(\"testScroll\").elastic = true;\n\t},\n\n\n\t_scrollveiwDidScrolled(){\n        //因为只拿了一个item复用，所以滑动的范围只要大于1就要重新加载\n        //向下滑\n        var isScrollDown = (this.start_index + this.page_num < this.prefabData.length&&this.itemContent.y - this.start_y >= this.itemHeight);\n\t\tif(isScrollDown){\n            this._scrollDown();\n            return;\n        }\n\n        //向上滑\n        var isScrollUp = (this.start_index > 0&& this.start_y - this.itemContent.y >= 0);\n\t\tif(isScrollUp){\n\t\t\tthis._scrollUp();\n\t\t}\n    },\n    \n    _scrollDown(){\n        //如果滑动的范围大于了1个item的高度，就要去加载新的数据\n        //每次加载一个数据\n\n        if(this.itemScrollView._autoScrolling){\n            this.itemScrollView.elastic = false;\n            return;\n        }\n\n        var down_loaded = 1;\n        this.start_index += down_loaded;\n\n        //如果往后再加载一个数据就超过了总的数据长度\n        console.log(\"start_index==\",this.start_index);\n        console.log(\"this.prefabData.length==\",this.prefabData.length);\n        if(this.start_index + this.page_num > this.prefabData.length){\n            //down_loaded要剪掉超过的项\n            var out_len = (this.start_index + this.page_num) - this.prefabData.length; //超过的长度\n            down_loaded -= out_len;\n            this.start_index -= out_len;\n            console.log(\"out out out out !!\");\n        }\n        this.reLoadData(this.start_index);\n        this.itemContent.y -= down_loaded*this.itemHeight;            \n    },\n\n    _scrollUp(){\n        if(this.itemScrollView._autoScrolling){\n            this.itemScrollView.elastic = false;\n            return;\n        }\n        var up_loaded = 1;\n        this.start_index -= up_loaded;\n        if(this.start.index < 0){\n            up_loaded += this.start_index;\n            this.start_index = 0;\n        }\n        this.reLoadData(this.start_index);\n        this.itemContent.y += up_loaded*this.itemHeight;\n    },\n\n    /**\n     * 列表的显示与隐藏\n     */\n    showClick(){\n\t\tthis.itemScrollView.active = true;\n\t\t//重新获取数据\n\t\tthis.initData();\n    },\n\n    hiddeClick(){\n        this.itemScrollView.active = false;\n    },\n\n\t//定时器\n    beginCountDown(){\n        this.countDownCallBack = function(){\n            if(cc.jsInstance.countDownLeftTime){\n                for(var i = 0; i < cc.jsInstance.countDownLeftTime.length;i++){\n                    var tempItem = cc.jsInstance.countDownLeftTime[i];\n                    if(tempItem.isClicked){\n                        tempItem.time--;\n                        if(tempItem.time === 0){\n                            tempItem.time = 120;\n                            tempItem.isClicked = false;\n                        }\n                    }\n                }\n            }\n\t\t};\n\t\tthis.schedule(this.countDownCallBack,1);\n    },\n\n    initPrefabItemCachePool:function(){\n\t\t//计算并且初始化需要的最多的预制体个数\n\t\tvar self = this;\n        this.page_num = Math.floor(this.itemContentHeight/this.itemHeight)+1; \n        \n\t\tfor(let i = 0; i < this.page_num;i++){\n\n\t\t\tlet prefabItem = cc.instantiate(this.prefabItem);\n            prefabItem.parent = this.itemContent;\n            prefabItem.active = false;\n            //这个地方注意下预制体的结构，自己获取要去监听的部分\n\t\t\tprefabItem.getChildByName(\"invitebtn\").on(cc.Node.EventType.TOUCH_END, function(touchEvent){\n\t\t\t\tlet index = prefabItem.physicalLocation;\n\t\t\t\tlet tempItem = self.countDownLeftTime[index];\n\t\t\t\ttempItem.isClicked = true;\n\t\t\t\tself.upDateLableString(prefabItem);\t\t\t\t\n\t\t\t}, prefabItem.getChildByName(\"invitebtn\"));\n\t\t\tthis.prefabItemCachePool.push(prefabItem);\t\n        }\n    },\n\n    update (dt) {\n\t\tthis._scrollveiwDidScrolled();\n\t},\n\t\n    /**\n     * 每次重新拉取新的数据都进行的初始化操作\n     */\n\tinitData(){\n        //this.initStart_Y 这个只初始化了一次所以是固定值 \n        //防止误修改\n\t\tthis.start_y = this.initStart_Y; \n\n        //content从头开始\n\t\tthis.itemContent.y = this.initStart_Y;\n\n\t\t//数据的索引初始化\n        this.start_index = 0;\n        \n        //请求新的数据\n        this.getData();\n    },\n\n    initCountDownLeftTimeArr(){\n        this.countDownLeftTime = [];\n        for(var i = 0; i < this.prefabData.length;i++){\n            var temp ={\n                name:i, //用户名称\n                time:120,//倒计时时间\n                isClicked:false,//是否被点击过\n            }\n            this.countDownLeftTime.push(temp);\t\n        }\n    },\n    \n    //请求新的数据 \n    getData(){\n        //模拟获取到的数据的长度，这里随机\n\t\tthis.randomLength = Math.floor(Math.random()*20);\n\n\t\t//请求下来的最新的数据数组\n\t\tthis.prefabData = [];\n\t\t\n\t\t//先装载数据\n        for(var i = 0; i < this.randomLength; i ++) {\n\t\t\tthis.prefabData.push(i);\n        }\n\n        //获取新数据，更新数据\n        this.updatePrefabData();\n    },\n\n    //更新数据 这个地方自己去处理数据\n    updatePrefabData(){\n        \n        //每次都替换，然后从大的存好了的数据里进行替换对象\n        this.initCountDownLeftTimeArr();      \n\n       //首次进入\n       if(!cc.jsInstance.countDownLeftTime){\n           cc.jsInstance.countDownLeftTime = this.countDownLeftTime.slice(0);\n       }else{\n\n           //所有的名字数组\n           var allNames = [];\n           allNames = this.setNameArr(allNames);\n           //如果总的数据里面有这个数据，那么countDownlefttime中的数据直接从数据里面取就好了\n           //如果没有，那么更新总的数据库 ，不用替换\n           for(var i = 0; i < this.countDownLeftTime.length;i++){\n               var item = this.countDownLeftTime[i];\n               var index = allNames.indexOf(item.name);\n               if(index >= 0){\n                   var oldItem = cc.jsInstance.countDownLeftTime[index];\n                   this.countDownLeftTime[i] = oldItem;\n               }else{\n                   cc.jsInstance.countDownLeftTime.push(item);\n               }\n           }\n       }\n       this.reLoadData(0);\n    },\n\n    setNameArr(nameArr){\n        for(var i = 0; i < cc.jsInstance.countDownLeftTime.length;i++){\n            var item = cc.jsInstance.countDownLeftTime[i];\n            nameArr.push(item.name);\n        }\n        return nameArr\n    },\n\n\n    _setNewNameArr(tempArr,newNameArr){\n        for(var i = 0; i < tempArr.length;i++){\n            var nameTemp = tempArr[i];\n            newNameArr.push(nameTemp.name);\n        }\n        return newNameArr;\n    },\n    \n});\n"]}