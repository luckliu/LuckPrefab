{"version":3,"sources":["prefab.js"],"names":["cc","Class","extends","Component","properties","itemScrollView","type","Node","default","prefabItem","Prefab","itemContent","start","initDataOnlyOnce","initData","initPrefabItemCachePool","reLoadData","start_index","on","scrollEnded","bind","beginCountDown","countDownLeftTime","initStart_Y","y","prefabItemCachePool","itemContentHeight","_contentSize","height","itemHeight","data","i","length","friendItemPrefab","label","getChildByName","getComponent","Label","inviteLab","physicalLocation","active","itemTemp","isClicked","string","time","prefabData","upDateLableString","item","self","schedule","index","tempItem","scrollveiwDidScrolled","node","elastic","isScrollDown","page_num","start_y","scrollDown","isScrollUp","scrollUp","_autoScrolling","down_loaded","console","log","out_len","up_loaded","showClick","hiddeClick","countDownCallBack","Math","floor","instantiate","parent","EventType","TOUCH_END","touchEvent","push","update","dt","getData","updatePrefabData","initCountDownLeftTimeArr","temp","name","randomLength","random","tempArr","nameArr","newNameArr","setNameArr","setTempArr","setNewNameArr","slice","addNewDataToCountDownLeftTime","newTempData","indexOf","nameTemp"],"mappings":"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","file":"prefab.js","sourceRoot":"../../../../assets/Script","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        itemScrollView:{\n            type:cc.Node,\n            default:null,\n        },\n\n        //预制体\n        prefabItem:{\n            type:cc.Prefab,\n            default:null,\n        },\n\n        //装预制体content\n        itemContent:{\n            type:cc.Node,\n            default:null,\n        },\n    },\n\n    start () {\n        //只初始化一次的数据\n        this.initDataOnlyOnce();\n        \n\t\t//初始化数据\n        this.initData();\n        \n        //预制体缓存池，只初始化一次\n        this.initPrefabItemCachePool();\n\n        //装载数据 从0开始\n        this.reLoadData(this.start_index);\n        \n        //监听滑动结束事件\n        this.itemScrollView.on(\"scroll-ended\", this.scrollEnded.bind(this), this);\n        \n        //启动定时器\n\t\tthis.beginCountDown();\n    },\n\n    initDataOnlyOnce(){\n        this.countDownLeftTime = [];                                    //记录每个item剩余时间的大数组 \n        this.initStart_Y = this.itemContent.y;                          //列表content的初始y的位置 \n        this.prefabItemCachePool = [];                                  //所有预制体的存放池\n        this.itemContentHeight = this.itemContent._contentSize.height   //content高度\n\t\tthis.itemHeight = this.prefabItem.data._contentSize.height\t\t//预制体的高度\n    },\n\n    //tableview 刷新数据\n    reLoadData(start_index){\n        this.start_index = start_index;\n        for(var i = 0; i < this.prefabItemCachePool.length; i ++) {\n            var friendItemPrefab = this.prefabItemCachePool[i];\n            //注意替换节点\n\t\t\tvar label = friendItemPrefab.getChildByName(\"name\").getComponent(cc.Label);\n            var inviteLab = friendItemPrefab.getChildByName(\"invitebtn\").getChildByName(\"invite\").getComponent(cc.Label);\n            \n            friendItemPrefab.physicalLocation = start_index+i;\n            \n\t\t\tif(start_index + i >= this.countDownLeftTime.length){\n\t\t\t\tfriendItemPrefab.active = false;\n\t\t\t\tcontinue;\n            }\n            \n\t\t\tfriendItemPrefab.active = true;\n            var itemTemp = this.countDownLeftTime[start_index+i];\n            \n\t\t\t//赋值\n\t\t\tif(itemTemp.isClicked){\n\t\t\t\tinviteLab.string = itemTemp.time;\n\t\t\t}else{\n\t\t\t\tinviteLab.string = \"邀请\";\n            }\n\n            //this.prefabData 对象取到name\n\t\t\tlabel.string = this.prefabData[start_index+i];\n        }\n\t},\n\n    //更新UI\n\tupDateLableString(item){\n        var self = this;\n        //定时器2，做赋值操作\n\t\tthis.schedule(function(){\n\t\t\tvar index = item.physicalLocation;\n\t\t\tvar tempItem = self.countDownLeftTime[index];\n\t\t\tif(tempItem.isClicked){\n                //注意替换节点\n\t\t\t\titem.getChildByName(\"invitebtn\").getChildByName(\"invite\").getComponent(cc.Label).string = tempItem.time;\n\t\t\t}else{\n\t\t\t\titem.getChildByName(\"invitebtn\").getChildByName(\"invite\").getComponent(cc.Label).string = \"邀请\";\n\t\t\t\ttempItem.isClicked = false;\n\t\t\t\ttempItem.time = 120;\n\t\t\t}\n\t\t},1);\n\t},\n\n\tscrollEnded(){\n\t\tthis.scrollveiwDidScrolled();\n\t\tthis.node.getChildByName(\"testScroll\").elastic = true;\n\t},\n\n\n\tscrollveiwDidScrolled(){\n        //因为只拿了一个item复用，所以滑动的范围只要大于1就要重新加载\n        //向下滑\n        var isScrollDown = (this.start_index + this.page_num < this.prefabData.length&&this.itemContent.y - this.start_y >= this.itemHeight);\n\t\tif(isScrollDown){\n            this.scrollDown();\n            return;\n        }\n\n        //向上滑\n        var isScrollUp = (this.start_index > 0&& this.start_y - this.itemContent.y >= 0);\n\t\tif(isScrollUp){\n\t\t\tthis.scrollUp();\n\t\t}\n    },\n    \n    scrollDown(){\n        //如果滑动的范围大于了1个item的高度，就要去加载新的数据\n        //每次加载一个数据\n\n        if(this.itemScrollView._autoScrolling){\n            this.itemScrollView.elastic = false;\n            return;\n        }\n\n        var down_loaded = 1;\n        this.start_index += down_loaded;\n\n        //如果往后再加载一个数据就超过了总的数据长度\n        console.log(\"start_index==\",this.start_index);\n        console.log(\"this.prefabData.length==\",this.prefabData.length);\n        if(this.start_index + this.page_num > this.prefabData.length){\n            //down_loaded要剪掉超过的项\n            var out_len = (this.start_index + this.page_num) - this.prefabData.length; //超过的长度\n            down_loaded -= out_len;\n            this.start_index -= out_len;\n            console.log(\"out out out out !!\");\n        }\n        this.reLoadData(this.start_index);\n        this.itemContent.y -= down_loaded*this.itemHeight;            \n    },\n\n    scrollUp(){\n        if(this.itemScrollView._autoScrolling){\n            this.itemScrollView.elastic = false;\n            return;\n        }\n        var up_loaded = 1;\n        this.start_index -= up_loaded;\n        if(this.start.index < 0){\n            up_loaded += this.start_index;\n            this.start_index = 0;\n        }\n        this.reLoadData(this.start_index);\n        this.itemContent.y += up_loaded*this.itemHeight;\n    },\n\n    showClick(){\n\t\tthis.itemScrollView.active = true;\n\t\t//重新获取数据\n\t\tthis.initData();\n\t\tthis.reLoadData(0);\n    },\n\n    hiddeClick(){\n        this.itemScrollView.active = false;\n    },\n\n\t//定时器\n    beginCountDown(){\n\t\tthis.countDownCallBack = function(){\n\t\t\tfor(var i = 0; i < this.countDownLeftTime.length;i++){\n\t\t\t\tvar tempItem = this.countDownLeftTime[i];\n\t\t\t\tif(tempItem.isClicked){\n\t\t\t\t\ttempItem.time--;\n\t\t\t\t\tif(tempItem.time === 0){\n\t\t\t\t\t\ttempItem.time = 120;\n\t\t\t\t\t\ttempItem.isClicked = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tthis.schedule(this.countDownCallBack,1);\n    },\n\n    initPrefabItemCachePool:function(){\n\t\t//计算并且初始化需要的最多的预制体个数\n\t\tvar self = this;\n        this.page_num = Math.floor(this.itemContentHeight/this.itemHeight)+1; \n        \n\t\tfor(let i = 0; i < this.page_num;i++){\n\n\t\t\tlet prefabItem = cc.instantiate(this.prefabItem);\n            prefabItem.parent = this.itemContent;\n            \n            //这个地方注意下预制体的结构，自己获取要去监听的部分\n\t\t\tprefabItem.getChildByName(\"invitebtn\").on(cc.Node.EventType.TOUCH_END, function(touchEvent){\n\t\t\t\tlet index = prefabItem.physicalLocation;\n\t\t\t\tlet tempItem = self.countDownLeftTime[index];\n\t\t\t\ttempItem.isClicked = true;\n\t\t\t\tself.upDateLableString(prefabItem);\t\t\t\t\n\t\t\t}, prefabItem.getChildByName(\"invitebtn\"));\n\t\t\tthis.prefabItemCachePool.push(prefabItem);\t\n        }\n    },\n\n    update (dt) {\n\t\tthis.scrollveiwDidScrolled();\n\t},\n\t\n    /**\n     * 每次重新拉取新的数据都进行的初始化操作\n     */\n\tinitData(){\n        //this.initStart_Y 这个只初始化了一次所以是固定值 \n        //防止误修改\n\t\tthis.start_y = this.initStart_Y; \n\n        //content从头开始\n\t\tthis.itemContent.y = this.initStart_Y;\n\n\t\t//数据的索引初始化\n        this.start_index = 0;\n        \n        //请求新的数据\n        this.getData();\n\n        //清空下线数据，增加新上线数据\n        this.updatePrefabData();\n    },\n\n    initCountDownLeftTimeArr(){\n        this.countDownLeftTime = [];\n        for(var i = 0; i < this.prefabData.length;i++){\n            var temp ={\n                name:i, //用户名称\n                time:120,//倒计时时间\n                isClicked:false,//是否被点击过\n            }\n            this.countDownLeftTime.push(temp);\t\n        }\n    },\n    \n    //请求新的数据 \n    getData(){\n        //模拟获取到的数据的长度，这里随机\n\t\tthis.randomLength = Math.floor(Math.random()*20);\n\n\t\t//请求下来的最新的数据数组\n\t\tthis.prefabData = [];\n\t\t\n\t\t//先装载数据\n        for(var i = 0; i < this.randomLength; i ++) {\n\t\t\tthis.prefabData.push(i);\n\t\t}\n    },\n\n    //更新数据\n    updatePrefabData(){\n        //保留旧的计时\n\t\tif(!this.countDownLeftTime.length){\n            this.initCountDownLeftTimeArr();\n            return;\n        }\n        \n        //最新的数据中筛选上次还在线的玩家，存到tempArr这个里\n        var tempArr = [];\n\n        //存储上一次的数据的名字集合\n        var nameArr = []; \n\n        //最新数据的名字集合\n        var newNameArr = [];\n\n        nameArr = this.setNameArr(nameArr);\n\n        tempArr = this.setTempArr(nameArr,tempArr);\n\n        //存的是tempArr里面对象的名字\n        newNameArr = this.setNewNameArr(tempArr,newNameArr);\n\n        //最新的数据里上次还在的玩家\n        this.countDownLeftTime = tempArr.slice(0);\n        \n        //prefabData 包含 this.countDownLeftTime数据\n        this.addNewDataToCountDownLeftTime(newNameArr);\n\t\t\n    },\n\n    addNewDataToCountDownLeftTime(newNameArr){\n        for(var i = 0; i < this.prefabData.length;i++){\n            var newTempData = this.prefabData[i];\n            //旧数据\n            if(newNameArr.indexOf(newTempData.name)>=0){\n                continue;\n            }\n\n            //新数据\n            var temp ={\n                name:i,\n                time:120,\n                isClicked:false,\n            }\n            this.countDownLeftTime.push(temp);\n        }\n    },\n\n    setNameArr(nameArr){\n        for(var i = 0; i < this.countDownLeftTime.length;i++){\n            var item = this.countDownLeftTime[i];\n            nameArr.push(item.name);\n        }\n        return nameArr\n    },\n\n    setTempArr(nameArr,tempArr){\n        for(var i = 0; i < this.prefabData.length;i++){\n            var nameTemp = this.prefabData[i];\n            var index = nameArr.indexOf(nameTemp);\n            if(index>=0){\n                var item = this.countDownLeftTime[index];\n                tempArr.push(item);\n            }\n        }\n        return tempArr;\n    },\n\n    setNewNameArr(tempArr,newNameArr){\n        for(var i = 0; i < tempArr.length;i++){\n            var nameTemp = tempArr[i];\n            newNameArr.push(nameTemp.name);\n        }\n        return newNameArr;\n    },\n    \n});\n"]}